import XMonad
import XMonad.Config.Desktop
import XMonad.Util.EZConfig (additionalKeys)
import XMonad.Hooks.DynamicLog
import XMonad.Util.Run

myTerminal = "kitty"
myModMask = mod4Mask

myWorkspaces = ["1:main", "2:web", "3:edit", "4:chat", "5:misc"]

myXmonadBar = "dzen2 -x '0' -y '0' -h '24' -w '640' -ta 'l' -fg '#FFFFFF' -bg '#1B1D1E'"
myStatusBar = "conky -c /home/luke/.xmonad/.conky_dzen | dzen2 -x '640' -w '1040' -h '24' -ta 'r' -bg '#1B1D1E' -fg '#FFFFFF' -y '0'"
myBitmapsDir = "/home/luke/.xmonad/dzen2"

main = do
    dzenLeftBar <- spawnPipe myXmonadBar
    dzenRightBar <- spawnPipe myStatusBar
    xmonad $ desktopConfig
        {
            terminal        = myTerminal
        ,   workspaces      = myWorkspaces
        ,   modMask         = myModMask
        ,   logHook         = myLogHook dzenLeftBar
        ,   borderWidth     = 2
        }
        `additionalKeys`
            [
                ((myModMask, xK_p),         spawn "dmenu_run -i -p '>'")
            ,   ((myModMask .|. shiftMask, xK_l),         spawn "xscreensaver-command -lock")
            ,   ((0,         xK_Print),     spawn "scrot -e 'mv $f ~/screenshots/'")
            ,   ((0,         0x1008ff12),   spawn "amixer -q sset Master toggle")        -- XF86AudioMute
            ,   ((0,         0x1008ff11),   spawn "amixer -q sset Master 5%-")   -- XF86AudioLowerVolume
            ,   ((0,         0x1008ff13),   spawn "amixer -q sset Master 5%+")   -- XF86AudioRaiseVolume
            ]

myLogHook h = dynamicLogWithPP $ def
    {
      ppCurrent           =   dzenColor "#ebac54" "#1B1D1E" . pad
    , ppVisible           =   dzenColor "white" "#1B1D1E" . pad
    , ppHidden            =   dzenColor "white" "#1B1D1E" . pad
    , ppHiddenNoWindows   =   dzenColor "#7b7b7b" "#1B1D1E" . pad
    , ppUrgent            =   dzenColor "black" "red" . pad
    , ppWsSep             =   " "
    , ppSep               =   "  |  "
    , ppLayout            =   dzenColor "#ebac54" "#1B1D1E" .
                              (\x -> case x of
                                  "Tall"             ->      "^i(" ++ myBitmapsDir ++ "/tall.xbm)"
                                  "Mirror Tall"      ->      "^i(" ++ myBitmapsDir ++ "/mtall.xbm)"
                                  "Full"                      ->      "^i(" ++ myBitmapsDir ++ "/full.xbm)"
                                  "Simple Float"              ->      "~"
                                  _                           ->      x
                              )
    , ppTitle             =   (" " ++) . dzenColor "white" "#1B1D1E" . dzenEscape
    , ppOutput            =   hPutStrLn h
    }
